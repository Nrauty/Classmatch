{% load static %}

<!DOCTYPE html>
<html>
<head>
    <title>Group Posts</title>
    <link rel="stylesheet" href="{% static 'group_posts.css' %}">
</head>
<body>

    <h2>Group Posts</h2>

    <div class='buttons'>
        {% if user.profile and user.profile.is_group_admin %}
            <a href="{% url 'create_group_post' %}" class="create-post-btn">&#43; Create a New Post</a>
        {% endif %}

        <a href="{% url 'home' %}" class="create-post-btn">&#x1f3e0; Back Home</a>
    </div>
    <div class="grid">
        {% for post in posts %}
            <div class="item blog">
                <div class="content">
                    <div class="title">
                        <h3>{{ forloop.counter }}: {{ post.title }}</h3>
                    </div>
                    {% if post.image %}
                        <div class="image-wrapper">
                            <img src="{{ post.image.url }}" alt="{{ post.title }}" class="post-image rounded">
                        </div>
                    {% endif %}
                </div>
            </div>
        {% empty %}
            <p>No posts available.</p>
        {% endfor %}
    </div>
    
    
    <script>
    function resizeGridItem(item) {
        let grid = document.getElementsByClassName("grid")[0];
        let rowHeight = parseInt(window.getComputedStyle(grid).getPropertyValue('grid-auto-rows'));
        let rowGap = parseInt(window.getComputedStyle(grid).getPropertyValue('grid-row-gap'));
        let content = item.querySelector('.content');
        if (!content) return;
        let rowSpan = Math.ceil((content.getBoundingClientRect().height + rowGap) / (rowHeight + rowGap));
        item.style.gridRowEnd = "span " + rowSpan;
    }

    function resizeAllGridItems() {
        let allItems = document.getElementsByClassName("item");
        for (let x = 0; x < allItems.length; x++) {
        resizeGridItem(allItems[x]);
        }
    }

    function resizeInstance(instance) {
        let item = instance.elements[0];
        resizeGridItem(item);
    }

    window.addEventListener("load", resizeAllGridItems);
    window.addEventListener("resize", resizeAllGridItems);

    document.addEventListener("DOMContentLoaded", function () {
        let allItems = document.getElementsByClassName("item");
        for (let x = 0; x < allItems.length; x++) {
        imagesLoaded(allItems[x], resizeInstance);
        }
    });

    </script>
</body>
</html>